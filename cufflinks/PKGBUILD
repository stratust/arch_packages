# Maintainer: Thiago Yukio Kikuchi Oliveira <stratust@gmail.com>

pkgname=cufflinks
pkgver=2.0.2
pkgrel=1
pkgdesc="Cufflinks assembles transcripts, estimates their abundances, and tests for differential expression and regulation in RNA-Seq samples.."
arch=("x86_64")
url="http://cufflinks.cbcb.umd.edu"
license=('Artistic')
depends=('boost' 'eigen3' 'python2' 'samtools' 'perl')
source=(http://cufflinks.cbcb.umd.edu/downloads/$pkgname-$pkgver.tar.gz
cufflinks-2.0.2_gcc-4.7.patch)
md5sums=('0ec57dcf6230ee81e59469c3f0722e38 5a02213c80b637a830f50b6882ce1fff')

build() {

  # Patching cufflinks for gcc4.7 as described in:
  # http://anonscm.debian.org/gitweb/?p=debian-med/cufflinks.git;a=blob;f=debian/patches/gcc-4.7.patch;h=63bfaede309d5a549f59a86f991a12297d993abf;hb=HEAD
  patch -p1 < $srcdir/cufflinks-2.0.2_gcc-4.7.patch

  cd $srcdir/$pkgname-$pkgver
  # cufflinks use python2 but archlinux uses python3 as default python
  perl -i -pne '$_ =~ s/python/python2/ if $_ =~ /^#!\/usr/' src/cuffmerge

  # Fixing foreach as described in:
  # http://seqanswers.com/forums/showthread.php?t=16637
  for x in src/*.cpp src/*.h; do sed 's/foreach/for_each/' $x > x; mv x $x; done
  perl -i -pne 's/include \<boost\/for_each\.hpp/include \<boost\/foreach\.hpp/' src/common.h

  export EIGEN_CPPFLAGS="-I/usr/include/eigen3"
  export LDFLAGS="-L/usr/lib -lboost_system"
  ./configure --prefix="$pkgdir/usr"

  make
  make install

}
